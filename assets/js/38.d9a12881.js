(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{346:function(t,s,n){"use strict";n.r(s);var a=n(1),e=Object(a.a)({},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"content"},[t._m(0),t._v(" "),n("h2",{attrs:{id:"github-仓库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#github-仓库","aria-hidden":"true"}},[t._v("#")]),t._v(" "),n("a",{attrs:{href:"https://github.com/webxiaoma/JavaScript-demos/tree/master/web-api/service-worker",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub 仓库"),n("OutboundLink")],1)]),t._v(" "),t._m(1),t._v(" "),n("p",[n("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API",target:"_blank",rel:"noopener noreferrer"}},[t._v("Service Worker"),n("OutboundLink")],1),t._v("是W3C组织提出的主要用来做持久的离线缓存。它脱离了"),n("code",[t._v("javascript")]),t._v("的主线程，在另一个线程上进行运行的，和"),n("code",[t._v("javascript")]),t._v("的主线程互不干扰，因为js运行在单线程上，所以使用"),n("code",[t._v("Service Worker")]),t._v("可以避免js一直等待耗资源、耗时间的复杂运算。这些耗资源、耗时间的复杂运算可以放到其他线程去操作，并且还可以将一些静态资源缓存起来。")]),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),n("p",[t._v("关于浏览器的兼容性可以"),n("a",{attrs:{href:"https://caniuse.com/#feat=serviceworkers",target:"_blank",rel:"noopener noreferrer"}},[t._v("查看这里"),n("OutboundLink")],1)]),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),t._m(19),t._v(" "),t._m(20),t._v(" "),t._m(21),t._v(" "),t._m(22),t._v(" "),t._m(23),t._m(24),t._v(" "),n("p",[t._v("判断石佛注册成功我们可以查看这里：")]),t._v(" "),t._m(25),t._v(" "),t._m(26),t._v(" "),n("p",[t._v("我们将"),n("code",[t._v("service-worker.js")]),t._v("文件注册为"),n("code",[t._v("Service Worker")]),t._v("后，浏览器就中就有了也给"),n("code",[t._v("worker context")]),t._v("了，这时，浏览器会安装并激活它，此时会触发"),n("code",[t._v("intall")]),t._v("事件，我们可以监听"),n("code",[t._v("install")]),t._v("事件，并在该事件下使用"),n("router-link",{attrs:{to:"/javascript/cache-api.html"}},[t._v("Cache API")]),t._v("缓存我们的静态资源。")],1),t._v(" "),t._m(27),n("p",[t._v("我们可以通过下面方法，来查看缓存的资源列表：")]),t._v(" "),t._m(28),t._v(" "),t._m(29),t._v(" "),t._m(30),t._v(" "),t._m(31),t._m(32),t._v(" "),t._m(33),t._v(" "),t._m(34),t._v(" "),t._m(35),t._v(" "),n("p",[t._v("另外我们也可以通过关闭页面tab，而是刷新浏览器使我们跟新的资源生效。我们需要做的就是：")]),t._v(" "),t._m(36),t._v(" "),t._m(37),t._m(38),t._v(" "),t._m(39),t._v(" "),t._m(40),t._v(" "),t._m(41),t._v(" "),t._m(42),t._v(" "),t._m(43),t._m(44),t._m(45),t._v(" "),t._m(46),t._v(" "),t._m(47),t._v(" "),t._m(48),t._m(49),t._m(50),t._v(" "),t._m(51),t._v(" "),t._m(52),t._m(53),t._m(54),t._v(" "),t._m(55),t._v(" "),n("p",[t._v("通知比较常见的使用情景包括电商网站提醒用户一些关注商品的价格变化，或是在线聊天网站提醒用户收到了新消息等等。")]),t._v(" "),n("p",[t._v("使用消息通知也很简单。")]),t._v(" "),t._m(56),t._m(57),t._v(" "),t._m(58),t._v(" "),t._m(59),n("p",[t._v("另外我们在发送通知前可能需要事先询问用户是否订阅该消息，只有用户订阅该消息后，我们才可以推送消息。")]),t._v(" "),t._m(60),n("p",[t._v("知道了消息通知的配置后我们还需要知道下面一些东西：")]),t._v(" "),t._m(61),t._v(" "),n("p",[t._v("我们可以在"),n("code",[t._v("service-worker.js")]),t._v("文件中监听通知的点击事件，来获取一些点击信息，比如用户点击后的信息，用户点击按钮的id，点击后关闭信息的操作，打开新窗口或关闭新窗口的操作，已经合并消息的操作，这些详细的操作可以"),n("a",{attrs:{href:"https://lavas.baidu.com/pwa/engage-retain-users/notification/notification-pattern",target:"_blank",rel:"noopener noreferrer"}},[t._v("访问这里"),n("OutboundLink")],1)]),t._v(" "),t._m(62),t._m(63),t._v(" "),t._m(64),t._m(65),t._v(" "),t._m(66),t._v(" "),t._m(67),t._v(" "),n("p",[t._v("具体的调试方法可以"),n("a",{attrs:{href:"https://lavas.baidu.com/pwa/offline-and-cache-loading/service-worker/service-worker-debug",target:"_blank",rel:"noopener noreferrer"}},[t._v("查看这篇文章"),n("OutboundLink")],1)]),t._v(" "),t._m(68),t._v(" "),t._m(69),t._v(" "),t._m(70),t._v(" "),n("hr"),t._v(" "),t._m(71),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://lavas.baidu.com/pwa/offline-and-cache-loading/service-worker/service-worker-introduction",target:"_blank",rel:"noopener noreferrer"}},[t._v("Service Worker"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://lavas.baidu.com/guide/vue/doc/vue/advanced/service-worker-postMessage#%E6%89%A9%E5%B1%95",target:"_blank",rel:"noopener noreferrer"}},[t._v("Service Worker 与页面通信"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API",target:"_blank",rel:"noopener noreferrer"}},[t._v("MDN Service Worker API"),n("OutboundLink")],1)])])])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"service-worker-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#service-worker-api","aria-hidden":"true"}},[this._v("#")]),this._v(" Service Worker API")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简介","aria-hidden":"true"}},[this._v("#")]),this._v(" 简介")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[s("code",[this._v("Service Worker")]),this._v(" 有以下功能和特性：")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ul",[n("li",[t._v("一个独立的"),n("code",[t._v("worker")]),t._v("线程，独立于当前网页进程，有自己独立的"),n("code",[t._v("worker context")]),t._v("。")]),t._v(" "),n("li",[t._v("一旦被"),n("code",[t._v("install")]),t._v("，就永远存在，除非被手动 "),n("code",[t._v("unregister")])]),t._v(" "),n("li",[t._v("用到的时候可以直接唤醒，不用的时候自动睡眠")]),t._v(" "),n("li",[t._v("可编程拦截代理请求和返回，缓存文件，缓存的文件可以被网页进程取到（包括网络离线状态）")]),t._v(" "),n("li",[t._v("离线内容开发者可控")]),t._v(" "),n("li",[t._v("能向客户端推送消息")]),t._v(" "),n("li",[t._v("不能直接操作"),n("code",[t._v("DOM")]),t._v("，没有"),n("code",[t._v("window")]),t._v(",但是可以使用"),n("code",[t._v("self")]),t._v("或"),n("code",[t._v("this")])]),t._v(" "),n("li",[t._v("必须在 "),n("code",[t._v("HTTPS")]),t._v("环境下才能工作（在本地测试时可以使用"),n("code",[t._v("localhost")]),t._v("和 "),n("code",[t._v("http://127.0.0.0")]),t._v(")")]),t._v(" "),n("li",[t._v("异步实现，内部大都是通过 "),n("code",[t._v("Promise")]),t._v(" 实现")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"生命周期"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#生命周期","aria-hidden":"true"}},[this._v("#")]),this._v(" 生命周期")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("Service Worker")]),this._v(" 的生命周期如下：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"/img/sw-lifecycle.png",alt:"生命周期"}})])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[n("strong",[t._v("1. "),n("code",[t._v("installing")]),t._v("安装：")]),t._v(" 这个状态发生在"),n("code",[t._v("Service Worker")]),t._v("注册之后，表示开始安装，触发 "),n("code",[t._v("install")]),t._v(" 事件回调指定一些静态资源进行离线缓存。\n"),n("code",[t._v("install")]),t._v(" 事件回调中有两个方法：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ul",[n("li",[n("code",[t._v("event.waitUntil()")]),t._v("：传入一个 "),n("code",[t._v("Promise")]),t._v(" 为参数，等到该 "),n("code",[t._v("Promise")]),t._v(" 为 "),n("code",[t._v("resolve")]),t._v(" 状态为止。")]),t._v(" "),n("li",[n("code",[t._v("self.skipWaiting()")]),t._v("："),n("code",[t._v("self")]),t._v(" 是当前 "),n("code",[t._v("context")]),t._v(" 的 "),n("code",[t._v("global")]),t._v(" 变量，执行该方法表示强制当前处在 "),n("code",[t._v("waiting")]),t._v(" 状态的 "),n("code",[t._v("Service Worker")]),t._v("进入 "),n("code",[t._v("activate")]),t._v(" 状态。")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[n("strong",[t._v("2. "),n("code",[t._v("installed")]),t._v("安装后：")]),t._v(" "),n("code",[t._v("Service Worker")]),t._v(" 已经完成了安装，并且等待其他的 "),n("code",[t._v("Service Worker")]),t._v(" 线程被关闭。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[n("strong",[t._v("3. "),n("code",[t._v("activating")]),t._v(" 激活：")]),t._v(" 这个状态下没有被其他的 "),n("code",[t._v("Service Worker")]),t._v(" 控制的客户端，允许当前的 "),n("code",[t._v("worker")]),t._v(" 完成安装，并且清除了其他的 "),n("code",[t._v("worker")]),t._v(" 以及关联缓存的旧缓存资源，等待新的 "),n("code",[t._v("Service Worker")]),t._v(" 线程被激活。"),n("code",[t._v("activate")]),t._v(" 回调中有两个方法：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ul",[n("li",[n("code",[t._v("event.waitUntil()")]),t._v("：传入一个 "),n("code",[t._v("Promise")]),t._v(" 为参数，等到该 "),n("code",[t._v("Promise")]),t._v(" 为 "),n("code",[t._v("resolve")]),t._v(" 状态为止。")]),t._v(" "),n("li",[n("code",[t._v("self.clients.claim()")]),t._v("：在 "),n("code",[t._v("activate")]),t._v(" 事件回调中执行该方法表示取得页面的控制权, 这样之后打开页面都会使用版本更新的缓存。旧的 "),n("code",[t._v("Service Worker")]),t._v(" 脚本不再控制着页面，之后会被停止。")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[n("strong",[t._v("4. "),n("code",[t._v("activated")]),t._v(" 激活后：")]),t._v(" 在这个状态会处理 "),n("code",[t._v("activate")]),t._v(" 事件回调 (提供了更新缓存策略的机会)。并可以处理功能性的事件 "),n("code",[t._v("fetch")]),t._v(" (请求)、"),n("code",[t._v("sync")]),t._v(" (后台同步)、"),n("code",[t._v("push")]),t._v(" (推送)。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[n("strong",[t._v("5. "),n("code",[t._v("redundant")]),t._v(" 废弃状态：")]),t._v(" 这个状态表示一个 "),n("code",[t._v("Service Worker")]),t._v(" 的生命周期结束。进入废弃 ("),n("code",[t._v("redundant")]),t._v(") 状态的原因可能为这几种：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ul",[n("li",[t._v("安装 ("),n("code",[t._v("install")]),t._v(") 失败")]),t._v(" "),n("li",[t._v("激活 ("),n("code",[t._v("activating")]),t._v(") 失败")]),t._v(" "),n("li",[t._v("新版本的 "),n("code",[t._v("Service Worker")]),t._v(" 替换了它并成为激活状态")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"事件类型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#事件类型","aria-hidden":"true"}},[this._v("#")]),this._v(" 事件类型")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"/img/sw-events.png",alt:"Service Worker 的事件"}})])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ul",[n("li",[n("strong",[n("code",[t._v("install")]),t._v("：")]),t._v(" "),n("code",[t._v("Service Worker")]),t._v(" 安装成功后被触发的事件，在事件处理函数中可以添加需要缓存的文件")]),t._v(" "),n("li",[n("strong",[n("code",[t._v("activate")]),t._v("：")]),t._v("  当 "),n("code",[t._v("Service Worker")]),t._v(" 安装完成后并进入激活状态，会触发 "),n("code",[t._v("activate")]),t._v(" 事件。通过监听 "),n("code",[t._v("activate")]),t._v(" 事件你可以做一些预处理，如对旧版本的更新、对无用缓存的清理等。")]),t._v(" "),n("li",[n("strong",[n("code",[t._v("message")]),t._v("：")]),t._v(" "),n("code",[t._v("Service Worker")]),t._v(" 运行于独立 "),n("code",[t._v("context")]),t._v(" 中，无法直接访问当前页面主线程的 "),n("code",[t._v("DOM")]),t._v(" 等信息，但是通过 "),n("code",[t._v("postMessage API")]),t._v("，可以实现他们之间的消息传递，这样主线程就可以接受 "),n("code",[t._v("Service Worker")]),t._v(" 的指令操作 "),n("code",[t._v("DOM")]),t._v("。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("Service Worker")]),this._v(" 有几个重要的功能性的的事件，这些功能性的事件支撑和实现了 "),s("code",[this._v("Service Worker")]),this._v(" 的特性。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ul",[n("li",[n("strong",[n("code",[t._v("fetch")]),t._v(" (请求)：")]),t._v(" 当浏览器在当前指定的 "),n("code",[t._v("scope")]),t._v(" 下发起请求时，会触发 "),n("code",[t._v("fetch")]),t._v(" 事件，并得到传有 "),n("code",[t._v("response")]),t._v(" 参数的回调函数，回调中就可以做各种代理缓存的事情了。")]),t._v(" "),n("li",[n("strong",[n("code",[t._v("push")]),t._v(" (推送)：")]),t._v(" "),n("code",[t._v("push")]),t._v(" 事件是为推送准备的。不过首先需要了解一下 "),n("code",[t._v("Notification API")]),t._v(" 和 "),n("code",[t._v("PUSH API")]),t._v("。通过 "),n("code",[t._v("PUSH API")]),t._v("，当订阅了推送服务后，可以使用推送方式唤醒 "),n("code",[t._v("Service Worker")]),t._v(" 以响应来自系统消息传递服务的消息，即使用户已经关闭了页面。")]),t._v(" "),n("li",[n("strong",[n("code",[t._v("sync")]),t._v("(后台同步)：")]),t._v(" "),n("code",[t._v("sync")]),t._v(" 事件由 "),n("code",[t._v("background sync")]),t._v(" (后台同步)发出。"),n("code",[t._v("background sync")]),t._v(" 配合 "),n("code",[t._v("Service Worker")]),t._v(" 推出的 "),n("code",[t._v("API")]),t._v("，用于为 "),n("code",[t._v("Service Worker")]),t._v(" 提供一个可以实现注册和监听同步处理的方法。但它还不在 "),n("code",[t._v("W3C Web API")]),t._v(" 标准中。在 "),n("code",[t._v("Chrome")]),t._v(" 中这也只是一个实验性功能，需要访问 "),n("code",[t._v("chrome://flags/#enable-experimental-web-platform-features")]),t._v("，开启该功能，然后重启生效。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"使用方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用方法","aria-hidden":"true"}},[this._v("#")]),this._v(" 使用方法")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"注册-service-worker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注册-service-worker","aria-hidden":"true"}},[this._v("#")]),this._v(" 注册 Service Worker")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("了解了"),n("code",[t._v("Service Worker")]),t._v("的生命周期和事件类型，我们使用"),n("code",[t._v("Service Worker")]),t._v("也是很简单。\n第一步我们需要在js主线程中注册"),n("code",[t._v("Service Worker")]),t._v(", 这个主线程可以是任意一个"),n("code",[t._v("js")]),t._v("文件，比如这里我们是"),n("code",[t._v("main.js")]),t._v("。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("// 判断浏览器是否支持serviceWorker")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'serviceWorker'")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("in")]),t._v(" navigator"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// 监听页面onload事件，等页面加载完成后注册serviceWorker")]),t._v("\n    window"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("addEventListener")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'load'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token comment"}},[t._v("// 注册serviceWorker")]),t._v("\n        "),n("span",{attrs:{class:"token comment"}},[t._v("// 调用register方法时，浏览器会判断Service Worker 线程是否已注册并做出相应的处理。")]),t._v("\n        navigator"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serviceWorker"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("register")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'./service-worker.js'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("scope"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./'")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("then")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("registration"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{attrs:{class:"token comment"}},[t._v("// 注册成功")]),t._v("\n                console"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"ServiceWorker 注册成功"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token keyword"}},[t._v("catch")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{attrs:{class:"token comment"}},[t._v("// 注册失败:(")]),t._v("\n                console"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'ServiceWorker 注册失败: '")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("需要注意的是"),n("code",[t._v("register")]),t._v("方法中的"),n("code",[t._v("scope")]),t._v("属性是设置"),n("code",[t._v("Service Worker")]),t._v("的作用域目录的，设置该作用域目录后，"),n("code",[t._v("Service Worker")]),t._v(" 线程只能捕获到该域下的页面中的"),n("code",[t._v("fetch")]),t._v("事件。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"/img/service-worker1.jpg",alt:"注册service worker"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("//service-worker.js")]),t._v("\n\n"),n("span",{attrs:{class:"token comment"}},[t._v("// 监听 service worker 的 install 事件")]),t._v("\n self"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("addEventListener")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'install'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{attrs:{class:"token comment"}},[t._v("// 如果监听到了 service worker 已经安装成功的话，就会调用 event.waitUntil 回调函数")]),t._v("\n      event"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("waitUntil")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n          "),n("span",{attrs:{class:"token comment"}},[t._v("// 安装成功后 ServiceWorker 状 态会从 installing 变为 installed")]),t._v("\n          "),n("span",{attrs:{class:"token comment"}},[t._v("// 安装成功后操作 CacheStorage 缓存，使用之前需要先通过 caches.open() 打开对应缓存空间。")]),t._v("\n          caches"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("open")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'v1.0.0'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("then")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cache"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n              "),n("span",{attrs:{class:"token comment"}},[t._v("// 通过 cache 缓存对象的 addAll 方法添加 precache 缓存")]),t._v("\n              "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" cache"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("addAll")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                "),n("span",{attrs:{class:"token string"}},[t._v("'./index.html'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),n("span",{attrs:{class:"token string"}},[t._v("'./main.css'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),n("span",{attrs:{class:"token string"}},[t._v("'./main.js'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),n("span",{attrs:{class:"token string"}},[t._v("'./img/manong.jpg'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n              "),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"/img/service-worker2.jpg",alt:"安装service worker"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"代理请求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#代理请求","aria-hidden":"true"}},[this._v("#")]),this._v(" 代理请求")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("我们的"),n("code",[t._v("Service Worker")]),t._v("已经建立起来了，并且我们也缓存了我们的静态资源，那么我们如何使用这写缓存的静态资源呢，这里就用到了"),n("code",[t._v("fetch")]),t._v("事件，我们可以监听"),n("code",[t._v("fetch")]),t._v("事件，当目录域内有交互请求时都会触发"),n("code",[t._v("Service Worker")]),t._v("的"),n("code",[t._v("fetch")]),t._v("事件，这时我们就可以做一些处理，是继续进行交互请求资源，还是拦截，使用缓存的资源。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("//service-worker.js")]),t._v("\n\n "),n("span",{attrs:{class:"token comment"}},[t._v("// 捕获请求并返回缓存数据")]),t._v("\nself"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("addEventListener")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'fetch'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// respondWith 方法可以劫持我们的请求")]),t._v("\n    event"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("respondWith")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        caches"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("match")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("then")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("response"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{attrs:{class:"token comment"}},[t._v("// 处理一些请求，代理的事情")]),t._v("\n            "),n("span",{attrs:{class:"token comment"}},[t._v("// 如果 Service Worker 有自己的返回，就直接返回，减少一次 http 请求")]),t._v("\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("response"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" response"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),n("span",{attrs:{class:"token comment"}},[t._v("// 如果 service worker 没有返回，那就得直接请求真实远程服务")]),t._v("\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" request "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" event"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("clone")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// 把原始请求拷过来")]),t._v("\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("fetch")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("then")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("httpRes"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{attrs:{class:"token comment"}},[t._v("// http请求的返回已被抓到，可以处置了。")]),t._v("\n\n                "),n("span",{attrs:{class:"token comment"}},[t._v("// 请求失败了，直接返回失败的结果就好了。。")]),t._v("\n                "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v("httpRes "),n("span",{attrs:{class:"token operator"}},[t._v("||")]),t._v(" httpRes"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),n("span",{attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("200")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" httpRes"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),n("span",{attrs:{class:"token comment"}},[t._v("// 请求成功的话，将请求缓存起来。")]),t._v("\n                "),n("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" responseClone "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" httpRes"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("clone")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                caches"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("open")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'v1.0.0'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("then")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cache"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    cache"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("put")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" responseClone"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" httpRes"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("我们可以通过下面，看出请求的资源是否来自"),s("code",[this._v("server worker")]),this._v(":")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"/img/service-worker3.jpg",alt:"安装service worker"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"更新"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#更新","aria-hidden":"true"}},[this._v("#")]),this._v(" 更新")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("当我们的文件更新了怎么办呢，不用担心，首先对于"),n("code",[t._v("service-worker.js")]),t._v("的更新，"),n("code",[t._v("Service Worker")]),t._v("会逐字节对比，发现不同时会启动更新算法，然后会安装最新的"),n("code",[t._v("service-worker.js")]),t._v("并触发"),n("code",[t._v("install")]),t._v("事件, 此时旧的"),n("code",[t._v("Service Worker")]),t._v("还真正使用，处于激活状态，新的"),n("code",[t._v("Service Worker")]),t._v("会进入"),n("code",[t._v("waiting")]),t._v("状态直到页面tab被全部关闭，新的"),n("code",[t._v("Service Worker")]),t._v("才会生效，另外"),n("code",[t._v("Service Worker")]),t._v(" 在24小时内会自动更新一次。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ul",[n("li",[t._v("在"),n("code",[t._v("Service Worker")]),t._v("进入安装阶段时，使用"),n("code",[t._v("self.skipWaiting()")]),t._v(" 跳过"),n("code",[t._v("waiting")]),t._v("状态直接进入激活（activate)状态")]),t._v(" "),n("li",[t._v("监听"),n("code",[t._v("activate")]),t._v("事件，在"),n("code",[t._v("activate")]),t._v("事件中执行"),n("code",[t._v("self.clients.claim()")]),t._v("来触发更新客户端上的"),n("code",[t._v("Service Worker")]),t._v("，并清理旧的"),n("code",[t._v("Service Worker")])]),t._v(" "),n("li",[t._v("修改"),n("code",[t._v("Service Worker")]),t._v("的版本")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("// 版本号，每当更新时，我们需要修改版本号，来更新，")]),t._v("\n"),n("span",{attrs:{class:"token comment"}},[t._v("// 当然你也可以使用随机生成的哈希值。")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" version "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'v1.0.0'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 安装阶段跳过等待，直接进入 active")]),t._v("\nself"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("addEventListener")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'install'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    event"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("waitUntil")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("skipWaiting")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nself"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("addEventListener")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'activate'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    event"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("waitUntil")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        Promise"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("all")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n            "),n("span",{attrs:{class:"token comment"}},[t._v("// 更新客户端")]),t._v("\n            self"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("clients"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("claim")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{attrs:{class:"token comment"}},[t._v("// 清理旧版本")]),t._v("\n            caches"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("keys")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("then")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cacheList"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" Promise"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("all")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                    cacheList"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("map")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cacheName"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cacheName "),n("span",{attrs:{class:"token operator"}},[t._v("!==")]),t._v(" version"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                            "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" caches"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token keyword"}},[t._v("delete")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cacheName"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("另外因为浏览器可能会缓存"),s("code",[this._v("service-worker.js")]),this._v("文件，我们需要刷新浏览器，才会看到效果，当然你也可以将"),s("code",[this._v("service-worker.js")]),this._v("文件配置"),s("code",[this._v("cache-control: no-cache")]),this._v("来禁止浏览器缓存该文件。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"传递信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#传递信息","aria-hidden":"true"}},[this._v("#")]),this._v(" 传递信息")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("有时候我们需要"),s("code",[this._v("Service Worker")]),this._v("进程和"),s("code",[this._v("js")]),this._v("的主进程进行通信，或者是其他两种进程之间通信。我们可以这样做")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"主进程向service-worker通信"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主进程向service-worker通信","aria-hidden":"true"}},[this._v("#")]),this._v(" 主进程向Service Worker通信")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("主进程向"),n("code",[t._v("Service Worker")]),t._v("通信我们可以在js主进程中通过"),n("code",[t._v("navigator.serviceWorker.controller.postMessage()")]),t._v("方法进行, 并在"),n("code",[t._v("Service Worker")]),t._v("进程中通过监听"),n("code",[t._v("message")]),t._v("事件来获取。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("// main.js 主进程")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'serviceWorker'")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("in")]),t._v(" window"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("navigator"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  navigator"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serviceWorker"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("register")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'./sw.js'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" scope"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./'")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("then")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("reg"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      console"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'success'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reg"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      navigator"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serviceWorker"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("controller "),n("span",{attrs:{class:"token operator"}},[t._v("&&")]),t._v(" navigator"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serviceWorker"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("controller"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("postMessage")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"来自主进程消息"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("// service-worker.js service-worker 进程")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("addEventListener")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'message'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// 接收主进程消息")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"tip custom-block"},[n("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),n("p",[t._v("注册"),n("code",[t._v("service worker")]),t._v("后 "),n("code",[t._v("registration.active")]),t._v(" 对象中也有"),n("code",[t._v("postMessage()")]),t._v(" 方法。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v(" navigator"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serviceWorker"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("register")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'./sw.js'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" scope"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./'")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("then")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("registration"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     registration"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("active"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("postMessage")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"service-worker向主进程通信"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#service-worker向主进程通信","aria-hidden":"true"}},[this._v("#")]),this._v(" Service Worker向主进程通信")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("从"),s("code",[this._v("Service Worker")]),this._v("进程向js主进程发送信息，我们可以这样做")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("// service-worker.js ")]),t._v("\n\nself"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("clients"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("matchAll")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("then")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("client "),n("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),n("span",{attrs:{class:"token comment"}},[t._v("//service-worker 进程发送消息")]),t._v("\n  client"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token number"}},[t._v("0")]),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("postMessage")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'service-worker 进程发来的消息'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("// main.js")]),t._v("\n\nnavigator"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serviceWorker"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("addEventListener")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'message'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// 接收到的消息")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n。\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"使用-messagechannel-通信"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-messagechannel-通信","aria-hidden":"true"}},[this._v("#")]),this._v(" 使用 MessageChannel 通信")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("除了上面两种通信方法外，我们还可以是要用"),n("code",[t._v("MessageChannel API")]),t._v("来实现通信。它允许我们创建一个新的信道并通过信道的两个 "),n("code",[t._v("MessagePort")]),t._v(" 属性来传递数据。也就是"),n("code",[t._v("MessageChannel")]),t._v("创建了一个信息通道，而这个通道有两个通信路径"),n("code",[t._v("port1")]),t._v("和"),n("code",[t._v("port2")]),t._v(",每个路径都可以通过"),n("code",[t._v("postMessage")]),t._v("来发送数据，通过"),n("code",[t._v("onmessage")]),t._v(" 回调接收数据。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("// main.js")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" messageChannel "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("MessageChannel")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'serviceWorker'")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("in")]),t._v(" navigator"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    window"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("addEventListener")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'load'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        navigator"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serviceWorker"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("register")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'./service-worker.js'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("scope"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./'")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("then")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("registration"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                 messageChannel"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("port1"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("onmessage")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" e "),n("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    console"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("//接收来自port2的信息")]),t._v("\n                 "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                 "),n("span",{attrs:{class:"token comment"}},[t._v("// 将messageChannel 的 第二个通道port2通道端口传给 service worker 进程")]),t._v("\n                 registration"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("active"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("postMessage")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'来自主线程的消息'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("messageChannel"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("port2"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                console"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"ServiceWorker 注册成功"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n               \n            "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token keyword"}},[t._v("catch")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{attrs:{class:"token comment"}},[t._v("// 注册失败:(")]),t._v("\n                console"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'ServiceWorker 注册失败: '")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("// service-worker.js ")]),t._v("\n\nself"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("addEventListener")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'message'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("event"),n("span",{attrs:{class:"token operator"}},[t._v("=>")]),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// 来自主线程的消息")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("//event.ports[0] 就是port2 通道端口")]),t._v("\n    event"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ports"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token number"}},[t._v("0")]),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("onmessage")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    event"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ports"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token number"}},[t._v("0")]),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("postMessage")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'来自service worker 的消息'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"消息通知"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#消息通知","aria-hidden":"true"}},[this._v("#")]),this._v(" 消息通知")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("service worker api")]),this._v("有一个功能"),s("code",[this._v("notification")]),this._v("可以实现消息通知，它允许服务器向用户提示一些信息，并根据用户不同的行为进行一些简单的处理。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'serviceWorker'")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("in")]),t._v(" navigator"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    window"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("addEventListener")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'load'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        navigator"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serviceWorker"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("register")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'./service-worker.js'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("scope"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./'")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("then")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("registration"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{attrs:{class:"token comment"}},[t._v("// 发送通知")]),t._v("\n                 registration"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("showNotification")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'webxiaoma'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                     "),n("span",{attrs:{class:"token comment"}},[t._v("// 视觉相关")]),t._v("\n                    "),n("span",{attrs:{class:"token string"}},[t._v('"body"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"发送消息了"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    "),n("span",{attrs:{class:"token string"}},[t._v('"icon"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./img/mxx48.jpg'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    "),n("span",{attrs:{class:"token string"}},[t._v('"badge"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./img/mxx.ico'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    "),n("span",{attrs:{class:"token string"}},[t._v('"image"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./img/mxx188.jpg'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    "),n("span",{attrs:{class:"token string"}},[t._v('"actions"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                        "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                            action"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'coffee-action'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                            title"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'确定'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                            icon"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./img/mxx.ico'")]),t._v("\n                        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                        "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                            action"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'doughnut-action'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                            title"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'取消'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                            icon"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./img/mxx.ico'")]),t._v("\n                        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                    "),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{attrs:{class:"token comment"}},[t._v("// 注册成功")]),t._v("\n                console"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"ServiceWorker 注册成功"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n               \n            "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token keyword"}},[t._v("catch")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{attrs:{class:"token comment"}},[t._v("// 注册失败:(")]),t._v("\n                console"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'ServiceWorker 注册失败: '")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("registration.showNotification(title ,options)")]),this._v(" 方法接收两个参数：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[s("code",[this._v("title")]),this._v(": 必填 字符串类型 表示通知的标题")]),this._v(" "),s("li",[s("code",[this._v("options")]),this._v(": 选填 对象类型 集合众多配置项，可用项如下")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-json extra-class"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[t._v("// 视觉相关\n"),n("span",{attrs:{class:"token property"}},[t._v('"body"')]),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"消息主题"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" // 消息主体\n"),n("span",{attrs:{class:"token property"}},[t._v('"icon"')]),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"<URL String>"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" //消息图标\n"),n("span",{attrs:{class:"token property"}},[t._v('"image"')]),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"<URL String>"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" //图片(image"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("在通知的展现尺寸要大不少，可以给用户展现一些预览图片。\n"),n("span",{attrs:{class:"token property"}},[t._v('"badge"')]),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"<URL String>"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" //手机上展现通知缩略信息时使用的小图标\n"),n("span",{attrs:{class:"token property"}},[t._v('"vibrate"')]),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token number"}},[t._v("500")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("110")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("500")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("110")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("450")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("110")]),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" // 震动(部分设备支持"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token property"}},[t._v('"sound"')]),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"path/to/sound.mp3"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" //声音"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("目前没有浏览器支持\n"),n("span",{attrs:{class:"token property"}},[t._v('"dir"')]),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("\"<String of 'auto' | 'ltr' | 'rtl'>\"")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" // 文字方向\n\n// 行为相关\n"),n("span",{attrs:{class:"token property"}},[t._v('"tag"')]),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"<String>"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" //标签 通知归类时会用到\n"),n("span",{attrs:{class:"token property"}},[t._v('"data"')]),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  // 从主程序向service worker 传递数据\n    "),n("span",{attrs:{class:"token property"}},[t._v('"message"')]),n("span",{attrs:{class:"token operator"}},[t._v(":")]),n("span",{attrs:{class:"token string"}},[t._v('"主程序消息"')]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{attrs:{class:"token property"}},[t._v('"requireInteraction"')]),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"<boolean>"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" //是否一直显示通知\n//在使用 tag 的同时，设置 renotify 为 "),n("span",{attrs:{class:"token boolean"}},[t._v("true")]),t._v(" 可以让浏览器在替换通知时提示声音或者震动\n"),n("span",{attrs:{class:"token property"}},[t._v('"renotify"')]),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"<Boolean>"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" //重新通知和 tag 一同使用\n"),n("span",{attrs:{class:"token property"}},[t._v('"silent"')]),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"<Boolean>"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" //静默通知\n\n// 视觉行为均会影响\n"),n("span",{attrs:{class:"token property"}},[t._v('"actions"')]),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" // 消息按钮\n     "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token property"}},[t._v('"action"')]),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"coffee-action"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" // 按钮id\n        "),n("span",{attrs:{class:"token property"}},[t._v('"title"')]),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"确定"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" // 按钮文本\n        "),n("span",{attrs:{class:"token property"}},[t._v('"icon"')]),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"./img/mxx.ico"')]),t._v(" // 按钮图片\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token property"}},[t._v('"action"')]),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"doughnut-action"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n        "),n("span",{attrs:{class:"token property"}},[t._v('"title"')]),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"取消"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{attrs:{class:"token property"}},[t._v('"icon"')]),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"./img/mxx.ico"')]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n// 定时发送时间戳\n"),n("span",{attrs:{class:"token property"}},[t._v('"timestamp"')]),n("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" Date.parse('"),n("span",{attrs:{class:"token number"}},[t._v("01")]),t._v(" Jan "),n("span",{attrs:{class:"token number"}},[t._v("2000")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("00")]),n("span",{attrs:{class:"token operator"}},[t._v(":")]),n("span",{attrs:{class:"token number"}},[t._v("00")]),n("span",{attrs:{class:"token operator"}},[t._v(":")]),n("span",{attrs:{class:"token number"}},[t._v("00")]),t._v("'"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" //定时发布\n")])])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token function"}},[t._v("addEventListener")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'load'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'serviceWorker'")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("in")]),t._v(" navigator"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          navigator"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serviceWorker"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("register")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'servcie-worker.js'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("scope"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./'")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("then")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("reg"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{attrs:{class:"token comment"}},[t._v("// 注册成功")]),t._v("\n                console"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"ServiceWorker 注册成功"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n                "),n("span",{attrs:{class:"token comment"}},[t._v("// 询问用户是否接收通知消息")]),t._v("\n                Notification"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("requestPermission")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("result"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),n("span",{attrs:{class:"token comment"}},[t._v("//status默认值'default'等同于拒绝 'denied' 意味着用户不想要通知 'granted' 意味着用户同意启用通知   ")]),t._v("\n                    \n                "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token keyword"}},[t._v("catch")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{attrs:{class:"token comment"}},[t._v("// 注册失败")]),t._v("\n                console"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'ServiceWorker 注册失败: '")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("1. 监听点击通知")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("// 监听通知点击事件")]),t._v("\nself"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("addEventListener")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'notificationclick'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" event "),n("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),n("span",{attrs:{class:"token comment"}},[t._v("// 获取点击对象")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" clickedNotification "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" event"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("notification"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("//关闭通知")]),t._v("\n    event"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("notification"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("close")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("//获取点击的按钮id（确定按钮或取消按钮等）")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" id "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" event"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("action\n\n   "),n("span",{attrs:{class:"token comment"}},[t._v("// 点击后关闭消息通知")]),t._v("\n    clickedNotification"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("close")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n\n     "),n("span",{attrs:{class:"token comment"}},[t._v("// 打开新窗口")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" examplePage "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'https://webxiaoma.com'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" promiseChain "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" clients"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("openWindow")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("examplePage"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    event"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("waitUntil")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("promiseChain"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// 存在异步操作时要调用")]),t._v("\n   \n\n   "),n("span",{attrs:{class:"token comment"}},[t._v("// 激活新窗口")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" urlToOpen "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'https://webxiaoma.com'")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// 必须同域下的地址")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" promiseChain "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" clients"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("matchAll")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// 获取所有激活窗口")]),t._v("\n        type"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'window'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("//表示我们需要寻找打开的窗口和标签，不包括 web workers")]),t._v("\n        includeUncontrolled"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("//表示不被 service worker 控制的但是属于自己域下的标签和窗口也都纳入搜索范围")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("then")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("windowClients "),n("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" matchingClient "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         console"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("windowClients"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("0")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" max "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" windowClients"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),n("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" max"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),n("span",{attrs:{class:"token operator"}},[t._v("++")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" windowClient "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" windowClients"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("windowClient"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url "),n("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" urlToOpen"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                matchingClient "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" windowClient"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{attrs:{class:"token keyword"}},[t._v("break")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n        "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" matchingClient\n            "),n("span",{attrs:{class:"token operator"}},[t._v("?")]),t._v(" matchingClient"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("focus")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// 激活窗口")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" clients"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("openWindow")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("urlToOpen"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    event"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("waitUntil")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("promiseChain"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// 存在异步操作时要调用")]),t._v("\n\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("2. 监听通知关闭事件")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("self"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("addEventListener")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'notificationclose'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" event "),n("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" dismissedNotification "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" event"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("notification"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" promiseChain "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("notificationCloseAnalytics")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    event"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("waitUntil")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("promiseChain"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"开发调试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开发调试","aria-hidden":"true"}},[this._v("#")]),this._v(" 开发调试")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("关于"),s("code",[this._v("service-worker")]),this._v("的开发调试，在浏览器端主要在"),s("code",[this._v("Application")]),this._v(" 中的 "),s("code",[this._v("Service Workers")]),this._v("中，")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"/img/service-worker1.jpg",alt:"注册service worker"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"实例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实例","aria-hidden":"true"}},[this._v("#")]),this._v(" 实例")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("上边的练习可以查看源代码"),s("a",{attrs:{href:""}},[this._v("GitHub 仓库")]),this._v("自己来测试, 也可使用手机扫描下面二维码，打开页面后，你在关闭手机的所有网络，刷新浏览器你会发现，页面依然可以访问（因为页面已经被缓存起来了）（建议用高版本的Chorme 测试）")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"https://webxiaoma.github.io/JavaScript-demos/web-api/service-worker/img/1540978100.png",alt:"二维码"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("参考文章")])])}],!1,null,null,null);e.options.__file="service-worker.md";s.default=e.exports}}]);