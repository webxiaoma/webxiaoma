<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<body>
  <script>
     
      // function P(fun){
      //     this.status = 'pending'
      //     this.result = undefined;
      //     this.error = undefined;
      //     this.successAry = [];
      //     this.errorAry = [];

      //     var value = null;
  
      //     var resolve =  function(res){
      //       console.log(this.successAry)
      //         this.result = res
      //         this.successAry.forEach(f => {
               
      //            if(value === null){
      //               value =  f(res)
      //               return
      //            }
                 
      //            if(value !== null&&value !== undefined){
      //              f(value)
      //            }
                
      //         });
             
      //     }.bind(this)

      //     var reject = function(err){
      //         this.result = err
      //         this.errorAry.forEach(f => {
      //            f(err)
      //         });

      //     }.bind(this)


      //     fun(resolve,reject)
          
      //     return this
         
      // }

      // P.prototype.then = function(callback){
    
      //     this.successAry.push(callback) 

      //     return this
      // }

      // P.prototype.catch = function(callback){
      //     this.errorAry.push(callback) 


      //     return this
      // }

      // var test = function(){
      //   return new P(function(resolve,reject){
      //       setTimeout(function(){
      //          var sum = Math.random()*10
      //          if(true){
      //            resolve(sum)
      //          }else{
      //            reject(sum)
      //          }
      //       },2000)
      //   })
      // }

      // console.dir(test())
      // test().then(function(arg){
      //    console.log(arg)
      //    return new Error("出错了")
      // }).then(function(arg){
      //    console.log(arg)
      // })




      function Promise(fun){
          this.thenCallback = [];
          this.catchCallback = [];

          var _that = this;
          
          function resolve(res){
              var value = res
              _that.thenCallback.forEach(function(f){
                  value = f(value)
              })
          }

          function reject(err){
            // if(_that.catchCallback){
            //   _that.catchCallback(err)
            // }
          }

          fun(resolve,reject) 

          return this
        }

        Promise.prototype.then = function(){
            var arg1 = arguments[0]
            var arg2 = arguments[1]

            this.thenCallback.push(arg1);
            this.catchCallback.push(arg2);

            return this
        }
        var pro = function(){
            return new Promise(function(resolve,reject){
                setTimeout(function(){
                  var sum = Math.floor(Math.random()*10);
                  if(sum>5){
                    resolve("success")
                  }else{
                    reject("error")
                  }
                },2000)
            })
        }

        pro().then(function(res){
            console.log(res)
            return 1111
        }).then(function(res){
          console.log(res)
        })
  </script>
</body>
</html>