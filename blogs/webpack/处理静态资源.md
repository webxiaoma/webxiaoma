---
sidebarDepth: 1
meta:
  - name: keywords
    content: webpack, webpack处理图像, url-loader，图片处理，压缩图片，image-webpack-loader，file-loader
  - name: description
    content: 本文主要讲述webpack中使用url-loader处理资源路径问题，使用image-webpack-loader处理图片的压缩问题。
---

# 处理静态资源

[GitHub 仓库练习](https://github.com/webxiaoma/webpack-demos/tree/master/webpack4/%E5%A4%84%E7%90%86%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90)

---


## 处理资源路径

使用`webpack`构建时,如果我们希望在页面引入图片（包括img的src和background的url）,引入图片会遇到一些问题。因为`webpack`会将各个模块打包到一个文件中，我们引入图片的路径是相对入口文件的路径，所以会出现问题，这时我们就要去解决。

### 使用file-loader

[`file-loader` 的作用](https://github.com/webpack-contrib/file-loader)就是讲js和css中导入的图片路径转化为正确的路径。


我们安装`file-loader`

```js
npm i -D file-loader
```
安装后配置也相当的简单,我们在`webpack.config.js`中配置

```js
module: {
  rules: [
    {
        test: /\.(png|jpe?g|gif)$/,
        use:['file-loader'],
    }
  ]
}
```

另外`file-loader` 也有一些[相关的配置](https://webpack.docschina.org/loaders/file-loader/), 例如：

```js
module: {
  rules: [
    {
      test: /\.(png|jpe?g|gif)$/,
      use: {
        loader: 'file-loader',
        options: {
            // 将图片打包到了path目录下，并生成原图片名加8位hash值的图片名
            name: '[path][name][hash:8].[ext]',
            // 将图片打包到该公共目录下
            outputPath: 'images/',
            // 图片引入资源的共路径，发布线上时很有用
            publicPath: 'assets/'
        }
      }
    }
  ]
}
```

### 使用 url-loader

我们打包出来的图片，在展示到页面时会发很多`http`请求，会降低页面性能。这个问题可以通过[url-loader](https://github.com/webpack-contrib/url-loader)解决。`url-loader`会将引入的图片编码，生成`dataURl`。相当于把图片数据翻译成一串字符。再把这串字符打包到文件中，最终只需要引入这个文件就能访问图片了。

[配置](https://webpack.docschina.org/loaders/url-loader/)

安装`url-loader`

```js
npm i -D url-loader
```

安装后配置也相当的简单,我们在`webpack.config.js`中配置

```js
module: {
  rules: [
    {
      test: /\.(png|jpe?g|gif|svg)$/,
      use: {
          loader: 'url-loader',
      }
    }
  ]
}
```

当然，如果图片较大，编码会消耗性能。因此`url-loader`提供了一个`limit`参数，小于`limit`字节的文件会被转为`DataURl`，大于`limit`的还会使用`file-loader`进行`copy`。所用url-loader中已经包含了`file-loader`, 我们在开发时可以只使用`url-loader`就可以。除了`limit`参数，`url-loader`还提供一些[额外的参数](https://webpack.docschina.org/loaders/url-loader/)

```js
module: {
  rules: [
    {
      test: /\.(png|jpe?g|gif)$/,
      use: {
          loader: 'url-loader',
          options:{
            // name 同flie-loader
            name:'[path][name][hash:8].[ext]',
            // 小于10000字节的转换为DataUrl格式
            limit:10000,
            // 是否采用file-loader， 默认采用
            // 还可以用responsive-loader等一些其他loader
            fallback: 'file-loader',
            // 设置要处理的MIME类型，
            mimetype:'image/png',
          }
      }
    }
  ]
}
```

:::tip 提示

`url-loader` 不仅仅可以处理图片，还可以处理音频视频、文档等等。如vue教程加中使用`url-loader`处理的资源：

```js
//图片
/\.(png|jpe?g|gif|svg)(\?.*)?$/   
//音频视频
/\.(mp4|webm|ogg|mp3|wav|flac|aac)(\?.*)?$/ 
//字体
/\.(woff2?|eot|ttf|otf)(\?.*)?$/
```
:::


## 压缩图片

我们在使用webpack打包图片时，除了将小图片转化为`DataURL`格式，我们还可以将图片进行压缩，这时候我们可以使用[image-webpack-loader](https://github.com/tcoopman/image-webpack-loader)。

```js
npm i -D image-webpack-loader
```

然后我们在`webpack.config.js`中进行配置

```js
module: {
  rules: [
    {
      test: /\.(png|jpe?g|gif)$/,
      use: [
        {
          loader: 'url-loader',
          options: {
              name: '[path][name][hash:8].[ext]',
              limit: 20 * 10
          }
        },
        {
          loader: 'image-webpack-loader',// 压缩图片
          options: {
              disable: false //是否禁止压缩，默认false
              quality: 80, //压缩质量，也可以是'70-80'
          }
        }
      ]
    }
  ]
}
```
现在我们就可以对图片进行压缩，并且压缩之后再判断图片是否转化为`DataURL`格式。


## 其他处理插件

- [webpack-spritesmith插件](https://github.com/mixtur/webpack-spritesmith) 生成雪碧图 


